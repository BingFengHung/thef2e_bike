{"version":3,"sources":["App.module.css","components/Map/Map.module.css","components/Header/Header.module.css","api/dataFetch.js","components/Map/Map.js","data/places.js","components/Header/Header.js","App.js","model/reducer.js","model/store.js","index.js"],"names":["module","exports","getAuthorizationHeader","GMTString","Date","toGMTString","ShaObj","jsSHA","setHMACKey","update","Authorization","getHMAC","query","a","console","log","axios","defaults","baseURL","headers","get","res","status","data","getData","Map","props","available","bikeAvailable","stations","bikeStations","mapContainer","useRef","useEffect","length","map","L","current","center","StationPosition","PositionLat","PositionLon","zoom","tileLayer","attribution","addTo","greenIcon","Icon","iconUrl","shadowUrl","iconSize","iconAnchor","popupAnchor","shadowSize","markers","markerClusterGroup","item","idx","marker","icon","bindPopup","StationName","Zh_tw","StationAddress","AvailableRentBikes","AvailableReturnBikes","forEach","addLayer","remove","className","style","container","ref","el","places","split","roads","i","bikeRoads","Header","stationsOptions","value","roadOptions","dispatch","useDispatch","logo","selectContainer","items","onChange","e","type","payload","itemNew","target","place","disabled","selected","App","useState","setBikeStations","setBikeAvailable","placeData","useSelector","state","stationData","bikeAvailableData","then","alert","fetchData","header","initState","menuItemData","itemStore","createStore","action","menuItemCopy","slice","concat","ReactDOM","render","StrictMode","store","document","getElementById"],"mappings":"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","file":"static/js/main.5ae8ddd9.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"App_container__1MQN3\",\"header\":\"App_header__3ZZ1n\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Map_container__3xh_q\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"Header_container__1VC87\",\"logo\":\"Header_logo__3_SJs\",\"selectContainer\":\"Header_selectContainer__Irzeo\",\"items\":\"Header_items__2Dz-W\"};","import axios from 'axios'\nimport jsSHA from 'jssha'\n\nfunction getAuthorizationHeader() {\n  //  填入自己 ID、KEY 開始\n  let AppID = \"83fc39f9c29946578ee26c17b458f970\";\n  let AppKey = \"0o53fh7JHKpoZBW2kIM8SM7GW4Y\";\n  //  填入自己 ID、KEY 結束\n  let GMTString = new Date().toGMTString();\n  let ShaObj = new jsSHA(\"SHA-1\", \"TEXT\");\n  ShaObj.setHMACKey(AppKey, \"TEXT\");\n  ShaObj.update(\"x-date: \" + GMTString);\n  let HMAC = ShaObj.getHMAC(\"B64\");\n  let Authorization =\n    'hmac username=\"' +\n    AppID +\n    '\", algorithm=\"hmac-sha1\", headers=\"x-date\", signature=\"' +\n    HMAC +\n    '\"';\n  return { Authorization: Authorization, \"X-Date\": GMTString };\n}\n\nasync function getData(query) {\n\ttry {\n    console.log('hi', query)\n\t\taxios.defaults.baseURL = 'https://ptx.transportdata.tw/MOTC'\n\t\taxios.defaults.headers = getAuthorizationHeader();\n\t\tlet res = await axios.get(query) \n\t\tif (res.status === 200) {\n\t\t\treturn res.data\n\t\t}\n\t}\n\tcatch (err) {\n\t\tconsole.log(err);\n\t}\n\n\treturn null;\n}\n\nexport default getData;","import \"leaflet/dist/leaflet.css\"\nimport L from \"leaflet\"\nimport { useEffect, useRef } from 'react'\nimport style from './Map.module.css'\n// 引入 leaflet.markercluster\nimport \"leaflet.markercluster/dist/MarkerCluster.css\"\nimport \"leaflet.markercluster/dist/MarkerCluster.Default.css\"\nimport \"leaflet.markercluster\";\nimport { useSelector } from \"react-redux\"\n\n\nfunction Map(props) {\n\tconst available = props.bikeAvailable\n\tconst stations = props.bikeStations;\n\tconst mapContainer = useRef();\n\n\n\tuseEffect(() => {\n\t\tif (stations === null || stations.length === 0) return null;\n\t\tconst map = L.map(mapContainer.current, {\n\t\t\tcenter: [stations[0].StationPosition.PositionLat, stations[0].StationPosition.PositionLon], \n\t\t\tzoom: 16 \n\t\t}); \n\t\t\n\t\tconst osmUrl = \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"; \n\t\tL.tileLayer(osmUrl, { \n\t\t\tattribution: \n\t\t\t'&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors', \n\t\t}).addTo(map); \n\t\t\n\t\tvar greenIcon = new L.Icon({ \n\t\t\ticonUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',\n\t\t\tshadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',\n\t\t\ticonSize: [25, 41], \n\t\t\ticonAnchor: [12, 41],\n\t\t\tpopupAnchor: [1, -34],\n\t\t\tshadowSize: [41, 41] \n\t\t}); \n\t\t\n\t\tvar markers = L.markerClusterGroup();\n\n\t\tstations.map((item, idx) => L.marker([item.StationPosition.PositionLat, item.StationPosition.PositionLon], {icon: greenIcon})\n\t\t.bindPopup(\n\t\t\t`<div> \n\t\t\t<h1>${item.StationName.Zh_tw}</h1>\n\t\t\t<p>${item.StationAddress.Zh_tw}</p>\n\t\t\t<p>可租借數量${available[idx].AvailableRentBikes}</p>\n\t\t\t<p>可歸還數量${available[idx].AvailableReturnBikes }</p>\n\t\t\t</div>\n\t\t\t`\n\t\t\t))\n\t\t.forEach(item => markers.addLayer(item))\n\n\t\tmap.addLayer(markers)\n\n\t\t           \n\n\n\n\t\t// unmount map function \n\t\treturn ()=> map.remove(); \n\t}, [stations]);\n\n\treturn (\n\t\t <div className={style.container} \n\t\t ref={el => mapContainer.current = el}> \n\t\t </div>\n\t)\n}\n// \tif (Object.keys(props.data).length !== 0) { \n// \t\tconsole.log('in')\n// \t\tlet map = L.map('map', { \n// \t\t\tcenter: [data[0].StationPosition.PositionLat, data[0].StationPosition.PositionLon], \n// \t\t\tzoom: 16 \n// \t\t});\n\n// \tconst osmUrl = \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"; \n// \tL.tileLayer(osmUrl, { \n// \t\tattribution: \n// \t\t'&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors', \n// \t}).addTo(map);\n\n// \tvar greenIcon = new L.Icon({\n//   iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',\n//   shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',\n//   iconSize: [25, 41],\n//   iconAnchor: [12, 41],\n//   popupAnchor: [1, -34],\n//   shadowSize: [41, 41]\n// });\n\n// \tdata.forEach(item => {\n// \t\tL.marker([item.StationPosition.PositionLat, item.StationPosition.PositionLon], {icon: greenIcon}).addTo(map)\n// \t\t.bindPopup(`<h1>${item.StationPosition.Zh_tw}</h1>`)\n// \t})\n// }\n// useEffect(() => { \n\t// \tlet map = L.map('map', {\n\t// \t\tcenter: [pos, lon],\n\t// \t\tzoom: 16,\n\t// \t});\n\n\t// \tconst osmUrl = \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\";\n\t// \t L.tileLayer(osmUrl, {\n  //       attribution:\n  //         '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors',\n  //     }).addTo(map);\n\n\t// \t\tL.marker([pos, lon], {\n\t// \t\t\ticon: L.icon({\n\t// \t\t\t\t iconUrl: \"/location.png\", \n\t// \t\t\t\t iconSize: [30, 30],\n\t// \t\t\t}),\n\t// \t\t}).addTo(map);\n\n\t// \treturn () => {map.remove()}\n\t// }, [pos, lon])\n\n\nexport default Map;","const placeName = `臺北市:Taipei\n新北市:NewTaipei\n桃園市:Taoyuan\n臺中市:Taichung\n臺南市:Tainan\n高雄市:Kaohsiung\n基隆市:Keelung\n新竹市:Hsinchu\n新竹縣:HsinchuCounty\n苗栗縣:MiaoliCounty\n彰化縣:ChanghuaCounty\n南投縣:NantouCounty\n雲林縣:YunlinCounty\n嘉義縣:ChiayiCounty\n嘉義市:Chiayi\n屏東縣:PingtungCounty\n宜蘭縣:YilanCounty\n花蓮縣:HualienCounty\n臺東縣:TaitungCounty\n金門縣:KinmenCounty\n澎湖縣:PenghuCounty\n連江縣:LienchiangCounty`;\n\nlet places = placeName.split(/\\r?\\n/);\n\nconst stationCounties = \n`臺中市:Taichung\n新竹市:Hsinchu\n苗栗縣:MiaoliCounty\n新北市:NewTaipei\n屏東縣:PingtungCounty\n金門縣:KinmenCounty\n桃園市:Taoyuan\n臺北市:Taipei\n高雄市:Kaohsiung\n臺南市:Tainan\n嘉義市:Chiayi`;\n\nlet stations = stationCounties.split(/\\r?\\n/);\n\nconst roadCountires = \n`臺中市:Taichung\n基隆市:Keelung\n新竹縣:HsinchuCounty\n苗栗縣:MiaoliCounty\n彰化縣:ChanghuaCounty\n新北市:NewTaipei\n南投縣:NantouCounty\n雲林縣:YunlinCounty\n嘉義縣:ChiayiCounty\n嘉義市:Chiayi\n屏東縣:PingtungCounty\n宜蘭縣:YilanCounty\n花蓮縣:HualienCounty\n臺東縣:TaitungCounty\n金門縣:KinmenCounty\n澎湖縣:PenghuCounty\n桃園市:Taoyuan\n臺北市:Taipei\n高雄市:Kaohsiung\n臺南市:Tainan`;\nlet roads = roadCountires.split(/\\r?\\n/);\n\n\nexport const placeList = places.map((i, idx) => i.split(':'));\nexport const bikeStations = stations.map((i, idx) => i.split(':'))\nexport const bikeRoads = roads.map(i => i.split(':'))","import style from './Header.module.css'\nimport { bikeStations, bikeRoads } from '../../data/places';\nimport { useDispatch } from 'react-redux';\n\nconst Header = (props) => {\n\tconst stationsOptions = bikeStations.map((i, idx) => <option key={idx} value={i[1]}>{i[0]}</option>)\n\tconst roadOptions = bikeRoads.map((i, idx) => <option key={idx} value={i[1]}>{i[0]}</option>)\n\n\tconst dispatch = useDispatch();\n\n\tfunction handleChange(e) {\n\t\t// EventBus.dispatch('rentBike', e.target.value);\n\t\tdispatch({ \n\t\t\ttype: 'ADD_ITEM', \n\t\t\tpayload: {itemNew: e.target.value}\t\n\t\t});\n\n\t\tdispatch({\n\t\t\ttype: 'PlaceSelect',\n\t\t\tpayload: {place: e.target.value}\n\t\t})\n\t}\n\n\treturn (\n\t\t<div className={style.container + \" \" +(props.style)}>\n\t\t\t<p className={style.logo}>Go Bike</p>\n\n\t\t\t<div>\n\t\t\t\t<div className={style.selectContainer}> \n\t\t\t\t<div className={style.items}>\n\t\t\t\t\t<p>Bike Station：</p> \n\t\t\t\t\t<select onChange={handleChange}>\n\t\t\t\t\t\t<option disabled selected value>租車/還車</option>\n\t\t\t\t\t\t{stationsOptions}\n\t\t\t\t\t</select> \n\t\t\t\t</div>\n\t\t\t\t\n\t\t\t\t<div className={style.items}>\n\t\t\t\t\t<p>自行車道：</p>\n\t\t\t\t\t<select>\n\t\t\t\t\t\t<option disabled selected value>自行車道</option>\n\t\t\t\t\t\t{roadOptions}\n\t\t\t\t\t</select>\n\t\t\t\t\t</div>\n\t\t\t\t</div> \n\n\t\t\t</div>\n\n\t\t</div>\n\t)\n}\n\nexport default Header;","import { useState, useEffect } from 'react';\nimport getData from './api/dataFetch';\nimport style from './App.module.css';\nimport Map from './components/Map/Map';\nimport Header from './components/Header/Header'\nimport { useSelector } from 'react-redux';\n\nfunction App() {\n  const [data, setData] = useState([])\n  const [bikeStations, setBikeStations] = useState([])\n  const [bikeAvailable, setBikeAvailable] = useState([])\n\tconst placeData = useSelector(state => state.place)\n\n  useEffect(() => {\n    let stationData = null;\n    let bikeAvailableData = null;\n    async function fetchData() {\n      await getData(`/v2/Bike/Station/${placeData}?$format=JSON`)\n      .then(res => {\n        // setData(res)\n        console.log('A')\n        stationData = res;\n      })\n\n      await getData(`v2/Bike/Availability/${placeData}?$format=JSON`)\n      .then(res =>{\n        console.log('B')\n        bikeAvailableData = res\n      })\n\n      console.log(stationData.length, bikeAvailableData.length)\n      if (stationData.length === bikeAvailableData.length) {\n        setBikeAvailable(bikeAvailableData)\n        setBikeStations(stationData)\n      }\n      else {\n        alert('Not compare')\n      }\n    }\n\n    fetchData()\n  }, [placeData]);\n\n  return (\n    <div className={style.container}>\n      <Header style={style.header}></Header> \n      <Map bikeAvailable={bikeAvailable} bikeStations={bikeStations}/>\n      {/* <Test value={data}/> */}\n    </div>\n  );\n}\n\nexport default App;\n","const initState = {\n\tmenuItemData: [\n\t\t\"Like的發問\",\n\t\t\"Like的回答\",\n\t\t\"Like的文章\",\n\t\t\"Like的留言\"\n\t],\n\tplace: 'NewTaipei'\n};\n\nconst itemReducer = (state = initState, action) => {\n\tswitch(action.type) {\n\n\t\tcase 'PlaceSelect': {\n\t\t\tconst data = state;\n\t\t\tdata.place = action.payload.place\n\n\t\t\treturn data;\n\t\t}\n\n\t\tcase 'ADD_ITEM': {\n\t\t\tconst menuItemCopy = state.menuItemData.slice();\n\t\t\tconsole.log(menuItemCopy)\n\t\t\treturn {\n\t\t\t\tmenuItemData: [action.payload.itemNew].concat(menuItemCopy)\n\t\t\t};\n\t\t}\n\n\t\tcase 'CLEAN_ITEM': {\n\t\t\treturn { menuItemData: [] };\n\t\t}\n\n\t\tdefault:\n\t\t\treturn state;\n\t}\n}\n\nexport { itemReducer };","import { createStore } from 'redux';\nimport { itemReducer } from './reducer';\n\nconst itemStore = createStore(itemReducer);\n\nexport { itemStore };\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport { Provider } from 'react-redux';\nimport { itemStore as store } from './model/store.js'\n\nReactDOM.render(\n  <React.StrictMode>\n    <Provider store={store}>\n      <App />\n    </Provider>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}